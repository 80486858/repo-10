# This file is generated by hacks/generate-controller-registration.sh - Do not commit, but change generation script!
---
apiVersion: core.gardener.cloud/v1beta1
kind: ControllerDeployment
metadata:
  name: cri-resmgr-extension
type: helm
providerConfig:
  chart: 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

  values:
    ### For development purposes - set it to 0 (if you want to register extension but use local process with "make start").
    # replicaCount: 1            

    ### Uncomment this is you want to overwrite extension image or internal installation and agent images.
    ### Remember to build and push image  "make REGISTRY=v2.isvimgreg.com TAG=mybranch build-images push-images"
    ### "image" overwrites extension (for seed) and "images" overwrite installation/agent (for shoot) images defined in charts/images.yaml
    #image:
    #  repository: v2.isvimgreg.com/gardener-extension-cri-resmgr
    #  tag: mybranch
    #  pullPolicy: Always
    #imageVectorOverwrite: |
    #  images:
    #  - name: gardener-extension-cri-resmgr-installation
    #    tag: mybranch
    #    repository: v2.isvimgreg.com/gardener-extension-cri-resmgr-installation
    #  - name: gardener-extension-cri-resmgr-agent
    #    tag: mybranch
    #    repository: v2.isvimgreg.com/gardener-extension-cri-resmgr-agent
    ### Uncomment to provide own "fallback" configuration for CRI-Resource-Manager
    ### Use ballons policy as an example:
    # based on: https://github.com/intel/cri-resource-manager/blob/master/sample-configs/balloons-policy.cfg
    configs:
      ### Those options are passed directly to cri-resmgr binary.
      EXTRA_OPTIONS: | 
        EXTRA_OPTIONS="--metrics-interval 30s" 
      ### This is *static* initial configuraiton file that will be passed do systemd unit
      fallback: |
        policy:
          Active: balloons
          AvailableResources:
            CPU: cpuset:1-128
          ReservedResources:
            CPU: 1
          balloons:
            PinCPU: true
            PinMemory: true
            BalloonTypes:
              - Name: "smallBalloon"
                MinCPUs: 2
                MaxCPUs: 2
                MinBalloons: 1
        instrumentation:
          HTTPEndpoint: :8891
          PrometheusExport: true
        logger:
          Debug: resource-manager,cache,policy,resource-control,config-server,cpuallocator
          Klog:
            # Enables nice logs with logger names that can be used in Debug
            skip_headers: true
        dump:
          Debug: true
          #Config: off:.*,full:((Create)|(Remove)|(Run)|(Update)|(Start)|(Stop)).*
      ### This is *dynamic* config that will be applied by cri-resmgr-agent
      default: |
        policy:
          Active: balloons
          AvailableResources:
            CPU: cpuset:1-128
          ReservedResources:
            CPU: 1
          balloons:
            BalloonTypes:
              - Name: "smallHPBalloon"
                MinCPUs: 2
                MaxCPUs: 2
                MinBalloons: 1
              - Name: "mediumLPBalloon"
                MinCPUs: 4
                MaxCPUs: 4
                MinBalloons: 1
        instrumentation:
          HTTPEndpoint: :8891
          PrometheusExport: true
        logger:
          Debug: resource-manager,cache,policy,resource-control,config-server,cpuallocator
          Klog:
            # Enables nice logs with logger names that can be used in Debug
            skip_headers: true
        dump:
          Debug: true
          #Config: off:.*,full:((Create)|(Remove)|(Run)|(Update)|(Start)|(Stop)).*

---
apiVersion: core.gardener.cloud/v1beta1
kind: ControllerRegistration
metadata:
  name: cri-resmgr-extension
spec:
  deployment:
    # For development purpose - deploy the extensions before even shoots are created (or enabled)
    #policy: Always
    deploymentRefs:
    - name: cri-resmgr-extension
  resources:
  - kind: Extension
    type: cri-resmgr-extension
    globallyEnabled: false
    reconcileTimeout: "120s"
